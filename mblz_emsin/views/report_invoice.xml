<?xml version='1.0' encoding='utf-8'?>
<odoo>
    <template id="inherit_report_invoice_document" inherit_id="account.report_invoice_document">
        <xpath expr="//t[@t-set='lines']" position="replace">
            <t t-if="all_lines">
                <t t-set="lines" t-value="o.invoice_line_ids.sorted(key=lambda l: (-l.sequence, l.date, l.move_name, -l.id), reverse=True)" />
            </t>
            <t t-else="">
                <t t-set="lines" t-value="o.get_printeable_lines().sorted(key=lambda l: (-l.sequence, l.date, l.move_name, -l.id), reverse=True)" />
            </t>
            
        </xpath>
        <xpath expr="//td[@colspan='99']" position="replace">
            <t t-if="o.invoice_render_method == 'one_line' and not all_lines">
                <td name="account_invoice_line_name">
                    <span t-field="line.name" t-options="{'widget': 'text'}" />
                </td>
                <td class="text-right">
                    1
                </td>
                <td t-attf-class="text-right {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                    <span class="text-nowrap" t-field="o.amount_untaxed" />
                </td>
                <td t-attf-class="text-right {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                    <span class="text-nowrap" t-field="o.amount_untaxed" />
                </td>

            </t>
            <t t-elif="o.invoice_render_method == 'line_per_sale' and not all_lines">
                <td name="account_invoice_line_name">
                    <span t-field="line.name" t-options="{'widget': 'text'}" />
                </td>
                <td class="text-right">
                    1
                </td>
                <td t-attf-class="text-right {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                    <span class="text-nowrap" t-esc="o.currency_format(o.get_sale_group_untaxed(line))" />
                </td>
                <td t-attf-class="text-right {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                    <span class="text-nowrap" t-esc="o.currency_format(o.get_sale_group_untaxed(line))" />
                </td>

            </t>
            <t t-else="">
                <td colspan="99">
                    <span t-field="line.name" t-options="{'widget': 'text'}" />
                </td>
                <t t-set="current_section" t-value="line" />
                <t t-set="current_subtotal" t-value="0" />

            </t>
        </xpath>
        <!-- <xpath expr="//tr[hasclass('is-subtotal')]" position="replace"/> -->
        <xpath expr="//t[@t-foreach='lines']/tr" position="attributes">
            <attribute name="t-att-class">'font-weight-bold o_line_section' if line.display_type == 'line_section' else 'font-italic o_line_note' if line.display_type == 'line_note' else ''</attribute>
        </xpath>
    </template>
    <template id="report_invoice_document_all_lines">
        <t t-set="all_lines" t-value="True"/>
        <t t-call="account.report_invoice" />
    </template>

    <record id="action_report_invoice_document_all_lines" model="ir.actions.report">
        <field name="name">Factura con Detalles</field>
        <field name="model">account.move</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">mblz_emsin.report_invoice_document_all_lines</field>
        <field name="report_file">mblz_emsin.report_invoice_document_all_lines</field>
        <field name="print_report_name">'Detalles de - %s %s' % (object.l10n_latam_document_type_id.name, object.l10n_latam_document_number)</field>
        <field name="binding_model_id" ref="model_account_move" />
        <field name="binding_type">report</field>
    </record>
</odoo>